module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";const n=(e,t)=>new Promise((n,o)=>{r(1).get(e,{headers:t},e=>{(e.statusCode<200||e.statusCode>299)&&o(new Error("Failed to load page, status code: "+e.statusCode));const t=[];e.on("data",e=>t.push(e)),e.on("end",()=>n(t.join("")))}).on("error",e=>o(e))}),o=(e,t)=>t?Math.ceil(Math.abs(e-t)/36e5):Math.ceil(Math.abs(Date.now()-e)/36e5),a=(e,t)=>t?Math.ceil(Math.abs(e-t)/6048e5):Math.ceil(Math.abs(Date.now()-e)/6048e5),s=async(e,t,r={})=>{const{digitaloceanApiKey:s}=r;if(!s)return{text:"You need `digitaloceanApiKey` secret to run this command. Create one by running `/nc secret_create`."};const c=[],u="https://api.digitalocean.com/v2",d={"Content-Type":"application/json",Authorization:`Bearer ${s}`};try{const e=n(u+"/droplets?per_page=100",d),t=n(u+"/databases?per_page=100",d),r=n(u+"/snapshots?per_page=100",d),s=n(u+"/volumes?per_page=100",d),[p,i,l,x]=await Promise.all([e,t,r,s]),{droplets:b}=JSON.parse(p),{databases:g}=JSON.parse(i),{volumes:m}=JSON.parse(x),{snapshots:y}=JSON.parse(l),h=((e=[])=>{let t=0,r=0;const n=new Date,a=new Date(n.getFullYear(),n.getMonth(),1),s=new Date(n.getFullYear(),n.getMonth()+1,1);for(const n of e){const e=new Date(n.created_at),c=n.size.price_hourly;let u=0;if(e>a){u=o(e);let t=o(s,e);t=t<672?t:672,r+=Number((t*c).toFixed(2))}else u=o(a),r+=Number((672*c).toFixed(2));u=u>672?672:u,t+=Number((u*c).toFixed(2))}return{current:t,projected:r}})(b),f=((e=[])=>{const t={"db-s-1vcpu-1gb":{1:.022},"db-s-1vcpu-2gb":{1:.045,2:.074,3:.104},"db-s-2vcpu-4gb":{1:.089,2:.149,3:.208},"db-s-4vcpu-8gb":{1:.179,2:.298,3:.417},"db-s-6vcpu-16gb":{1:.357,2:.595,3:.833},"db-s-8vcpu-32gb":{1:.714,2:1.19,3:1.667},"db-s-16vcpu-64gb":{1:2.381,2:3.333}};let r=0,n=0;const a=new Date,s=new Date(a.getFullYear(),a.getMonth(),1),c=new Date(a.getFullYear(),a.getMonth()+1,1);for(const a of e){let e=0;const u=t[a.size][a.num_nodes],d=new Date(a.created_at);if(d>s){e=o(d);let t=o(c,d);t=t<672?t:672,n+=Number((t*u).toFixed(2))}else e=o(s),n+=Number((672*u).toFixed(2));e=e>672?672:e,r+=Number((e*u).toFixed(2))}return{current:r,projected:n}})(g),w=((e=[])=>{let t=0,r=0;const n=new Date,a=new Date(n.getFullYear(),n.getMonth(),1),s=new Date(n.getFullYear(),n.getMonth()+1,1);for(const n of e){let e=0;const c=.1*n.size_gigabytes/672,u=new Date(n.created_at);if(u>a){e=o(u);let t=o(s,u);t=t<672?t:672,r+=Number((t*c).toFixed(2))}else e=o(a),r+=Number((672*c).toFixed(2));e=e>672?672:e,t+=Number((e*c).toFixed(2))}return{current:t,projected:r}})(m),F=((e=[])=>{let t=0,r=0;const n=new Date,a=new Date(n.getFullYear(),n.getMonth(),1),s=new Date(n.getFullYear(),n.getMonth()+1,1);for(const n of e){let e=0;const c=.05*n.size_gigabytes/672,u=new Date(n.created_at);if(u>a){e=o(u);let t=o(s,u);t=t<672?t:672,r+=Number((t*c).toFixed(2))}else e=o(a),r+=Number((672*c).toFixed(2));e=e>672?672:e,t+=Number((e*c).toFixed(2))}return{current:t,projected:r}})(y),{backupsCost:j,totalBackups:$}=((e=[])=>{let t=0,r=0,n=0;const o=new Date,s=new Date(o.getFullYear(),o.getMonth(),1),c=new Date(o.getFullYear(),o.getMonth()+1,1);for(const o of e)if(o.features.includes("backups")){n+=o.backup_ids.length;const e=new Date(o.created_at),u=672*o.size.price_hourly/100*5;let d=0;if(e>s){d=0===o.backup_ids.length?0:a(e);let t=a(c,e);t=t<4?t:4,r+=Number((t*u).toFixed(2))}else d=0===o.backup_ids.length?0:a(s),r+=Number((4*u).toFixed(2));d=d>4?4:d,t+=Number((d*u).toFixed(2))}return{backupsCost:{current:t,projected:r},totalBackups:n}})(b),_=(h.current+f.current+w.current+F.current+j.current).toFixed(2),k=(h.projected+f.projected+w.projected+F.projected+j.projected).toFixed(2),D=new Date,M=String(D.getMonth()+1)+"/"+D.getFullYear();c.push({type:"section",text:{type:"mrkdwn",text:`Total Costs: $${_} Projected Costs (${M}): $${k}`}}),h.projected>0&&c.push({type:"context",elements:[{type:"mrkdwn",text:`*Droplets* (${b.length})   `},{type:"mrkdwn",text:`Current: $${h.current.toFixed(2)}`},{type:"mrkdwn",text:`Projected: $${h.projected.toFixed(2)}`}]}),w.projected>0&&c.push({type:"context",elements:[{type:"mrkdwn",text:`*Volumes* (${m.length})   `},{type:"mrkdwn",text:`Current: $${w.current.toFixed(2)}`},{type:"mrkdwn",text:`Projected: $${w.projected.toFixed(2)}`}]}),f.projected>0&&c.push({type:"context",elements:[{type:"mrkdwn",text:`*Databases* (${g.length}) `},{type:"mrkdwn",text:`Current: $${f.current.toFixed(2)}`},{type:"mrkdwn",text:`Projected: $${f.projected.toFixed(2)}`}]}),F.projected>0&&c.push({type:"context",elements:[{type:"mrkdwn",text:`*Snapshots* (${y.length})    `},{type:"mrkdwn",text:`Current: $${F.current.toFixed(2)}`},{type:"mrkdwn",text:`Projected: $${F.projected.toFixed(2)}`}]}),j.projected>0&&c.push({type:"context",elements:[{type:"mrkdwn",text:`*Backups* (${$})  `},{type:"mrkdwn",text:`Current: $${j.current.toFixed(2)}`},{type:"mrkdwn",text:`Projected: $${j.projected.toFixed(2)}`}]})}catch(e){c.push({type:"section",text:{type:"mrkdwn",text:`*ERROR:* ${e.message}`}})}return{response_type:"in_channel",blocks:c}};e.exports=async({__secrets:e={},commandText:t,...r})=>({body:await s(0,0,e)})},function(e,t){e.exports=require("https")}]);